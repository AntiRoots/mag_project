name: Genereeri ja uuenda graafik

on:
  push:
    paths:
      - "data/kohtulahendid.csv"  # K√§ivitub ainult siis, kui CSV muutub
  schedule:
    - cron: '0 0 * * 1'  # K√§ivitab igal esmasp√§eval kell 00:00 UTC
  workflow_dispatch:  # V√µimaldab k√§sitsi k√§ivitada

jobs:
  generate-chart:
    runs-on: ubuntu-latest
    steps:
      - name: Klooni repositoorium
        uses: actions/checkout@v3

      - name: Paigalda Python ja s√µltuvused
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Installi Pandas ja Matplotlib
        run: pip install pandas matplotlib

      - name: K√§ivita skript ja loo graafik
        run: python scripts/generate_chart.py

      - name: Kontrolli, kas graafik on loodud
        run: |
          echo "üìÇ Kontrollin kausta sisu:"
          ls -lah docs/
          echo "üñº Faili t√º√ºp:"
          file docs/chart.png || echo "‚ùå Graafikut ei leitud!"

      - name: Commiti ja pushi uus graafik
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com
